<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="UTF-8">
    <title>flowPanel4</title>
    <script src="https://cdn.bootcdn.net/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
    <!--    <script src="../../demo/jquery.dragsort-0.5.2.min.js"></script>-->

    <style>
        .panel * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        .panel {
            border: 1px solid blue;
            width: 100%;
            height: 650px;
            position: relative;
        }

        /* 水平  */
        .horizontal-panel-wrapper {
            height: 42px;
            width: 100%;
            border: 1px solid red;
            padding-left: 40px;
            position: absolute;
            top: 0;
            display: flex;
        }
        .horizontal-panel-wrapper .item {
            width: 240px;
            height: 40px;
            line-height: 40px;
            padding: 0 30px;
            border-right: 1px solid black;
        }
        .horizontal-panel-wrapper .item:hover {
            resize: horizontal;
        }
        .horizontal-panel-wrapper > .item-wrapper {
            display: flex;
        }
        .panel .item {
            position: relative;
            display: flex;
            justify-content: center;
            overflow: auto;
        }
        .panel .item > span {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            cursor: default;
        }

        /* 垂直 */
        .vertical-panel-wrapper {
            height: 640px;
            width: 42px;
            border: 1px solid red;
            position: absolute;
        }
        .vertical-panel-wrapper .item {
            height: 200px;
            border-bottom: 1px solid black;
            padding: 30px 0;
            width: 40px;
            -webkit-writing-mode: vertical-rl;
            writing-mode: vertical-lr;
            overflow: hidden;
            display: flex;
            align-items: center;
        }
        .vertical-panel-wrapper .item:hover {
            resize: vertical;
        }

        /* 新增 */
        .item-icon-add svg {
            fill: black;
            position: absolute;
            top: 50%;
            left: 50%;
            -webkit-transform: translate(-50%, -50%);
            -moz-transform: translate(-50%, -50%);
            -ms-transform: translate(-50%, -50%);
            -o-transform: translate(-50%, -50%);
            transform: translate(-50%, -50%);
        }
        .item-icon-add {
            display: none;
            width: 30px;
            position: absolute;
            z-index: 9;
        }
        .item-icon-add:hover {
            cursor: pointer;
        }
        .item-icon-add svg {
            fill: grey;
        }
        .item-icon-add:hover svg {
            fill: black;
        }
        .horizontal-panel-wrapper > .item-icon-add {
            height: 40px;
            line-height: 40px;
            padding: 0 10px;
        }
        .vertical-panel-wrapper > .item-icon-add {
            /*margin-top: 40px;*/
            height: 30px;
            width: 40px;
            text-align: center;
            padding: 6px 0;
        }
        .horizontal-panel-wrapper:hover .item-icon-add {
            display: block;
        }

        /* 删除图标*/
        .item-icon-delete {
            display: none;
        }
        .item-icon-delete:hover {
            cursor: pointer;
        }
        .item-icon-delete:hover svg {
            fill: red;
        }
        .item:hover .item-icon-delete {
            display: block;
        }
        .item-icon-delete svg {
            fill: lightcoral;
            position: absolute;
        }
        .horizontal-panel-wrapper .item-icon-delete svg {
            right: .5em;
            top: 50%;
            -webkit-transform: translate(0, -50%);
            -moz-transform: translate(0, -50%);
            -ms-transform: translate(0, -50%);
            -o-transform: translate(0, -50%);
            transform: translate(0, -50%);
        }
        .vertical-panel-wrapper .item-icon-delete svg {
            bottom: .5em;
            left: 50%;
            -webkit-transform: translate(-50%, 0);
            -moz-transform: translate(-50%, 0);
            -ms-transform: translate(-50%, 0);
            -o-transform: translate(-50%, 0);
            transform: translate(-50%, 0);
        }
        .toggle-panel {
            width: 40px;
            height: 40px;
        }
        .toggle-panel:hover {
            background: grey;
        }

        body {
            background-color: gainsboro;
        }

        .placeHolder {
            background-color: lightcoral !important;
            border: dashed 1px gray !important;
        }

    </style>

</head>
<body>

<div class="panel"></div>

<script>
    class Lane {
        #data = {vert: [], horz: []}

        constructor(root) {
            this.root = root
            this.#init()
        }

        #init() {
            Lane.#initXY("x", this.root)
            Lane.#initXY("y", this.root)
            this.#handleCSS()
            this.#addDefaultField("x", {title: "xxx"})
            this.#addDefaultField("y", {title: "yyy"})
            this.#editable()
            this.#togglePanel()
        }

        // 拖曳排序
        function(e) {
            e.fn.dragsort = function (t) {
                if (t === "destroy") {
                    e(this.selector).trigger("dragsort-uninit");
                    return
                }
                let n = e.extend({}, e.fn.dragsort.defaults, t);
                let r = [];
                let i = null, s = null;
                this.each(function (t, o) {
                    if (e(o).is("table")
                        && e(o).children().size() === 1
                        && e(o).children().is("tbody")) o = e(o).children().get(0);
                    let u = {
                        draggedItem: null,
                        placeHolderItem: null,
                        pos: null,
                        offset: null,
                        offsetLimit: null,
                        scroll: null,
                        container: o,
                        init: function () {
                            n.tagName = e(this.container).children().size() === 0 ? "li" : e(this.container).children().get(0).tagName.toLowerCase();
                            if (n.itemSelector === "") n.itemSelector = n.tagName;
                            if (n.dragSelector === "") n.dragSelector = n.tagName;
                            if (n.placeHolderTemplate === "") n.placeHolderTemplate = "<" + n.tagName + ">&nbsp;</" + n.tagName + ">";
                            e(this.container).attr("data-listidx", t).mousedown(this.grabItem).bind("dragsort-uninit", this.uninit);
                            this.styleDragHandlers(true)
                        },
                        uninit: function () {
                            var t = r[e(this).attr("data-listidx")];
                            e(t.container).unbind("mousedown", t.grabItem).unbind("dragsort-uninit");
                            t.styleDragHandlers(false)
                        },
                        getItems: function () {
                            return e(this.container).children(n.itemSelector)
                        },
                        styleDragHandlers: function (t) {
                            this.getItems().map(function () {
                                return e(this).is(n.dragSelector) ? this : e(this).find(n.dragSelector).get()
                            }).css("cursor", t ? "pointer" : "")
                        },
                        grabItem: function (t) {
                            var i = r[e(this).attr("data-listidx")];
                            var s = e(t.target).closest("[data-listidx] > " + n.tagName).get(0);
                            var o = i.getItems().filter(function () {
                                return this === s
                            }).size() > 0;
                            if (t.which !== 1 || e(t.target).is(n.dragSelectorExclude) || e(t.target).closest(n.dragSelectorExclude).size() > 0 || !o) return;
                            t.preventDefault();
                            var u = t.target;
                            while (!e(u).is(n.dragSelector)) {
                                if (u === this) return;
                                u = u.parentNode
                            }
                            e(u).attr("data-cursor", e(u).css("cursor"));
                            e(u).css("cursor", "move");
                            var a = this;
                            var f = function () {
                                i.dragStart.call(a, t);
                                e(i.container).unbind("mousemove", f)
                            };
                            e(i.container).mousemove(f).mouseup(function () {
                                e(i.container).unbind("mousemove", f);
                                e(u).css("cursor", e(u).attr("data-cursor"))
                            })
                        },
                        dragStart: function (t) {
                            if (i != null && i.draggedItem != null) i.dropItem();
                            i = r[e(this).attr("data-listidx")];
                            i.draggedItem = e(t.target).closest("[data-listidx] > " + n.tagName);
                            i.draggedItem.attr("data-origpos", e(this).attr("data-listidx") + "-" + e(i.container).children().index(i.draggedItem));
                            var s = parseInt(i.draggedItem.css("marginTop"));
                            var o = parseInt(i.draggedItem.css("marginLeft"));
                            i.offset = i.draggedItem.offset();
                            i.offset.top = t.pageY - i.offset.top + (isNaN(s) ? 0 : s) - 1;
                            i.offset.left = t.pageX - i.offset.left + (isNaN(o) ? 0 : o) - 1;
                            if (!n.dragBetween) {
                                var u = e(i.container).outerHeight() === 0 ? Math.max(1, Math.round(.5 + i.getItems().size() * i.draggedItem.outerWidth() / e(i.container).outerWidth())) * i.draggedItem.outerHeight() : e(i.container).outerHeight();
                                i.offsetLimit = e(i.container).offset();
                                i.offsetLimit.right = i.offsetLimit.left + e(i.container).outerWidth() - i.draggedItem.outerWidth();
                                i.offsetLimit.bottom = i.offsetLimit.top + u - i.draggedItem.outerHeight()
                            }
                            var a = i.draggedItem.height();
                            var f = i.draggedItem.width();
                            if (n.tagName === "tr") {
                                i.draggedItem.children().each(function () {
                                    e(this).width(e(this).width())
                                });
                                i.placeHolderItem = i.draggedItem.clone().attr("data-placeholder", true);
                                i.draggedItem.after(i.placeHolderItem);
                                i.placeHolderItem.children().each(function () {
                                    e(this).css({
                                        borderWidth: 0,
                                        width: e(this).width() + 1,
                                        height: e(this).height() + 1
                                    }).html("&nbsp;")
                                })
                            } else {
                                i.draggedItem.after(n.placeHolderTemplate);
                                i.placeHolderItem = i.draggedItem.next().css({
                                    height: a,
                                    width: f
                                }).attr("data-placeholder", true)
                            }
                            if (n.tagName === "td") {
                                var l = i.draggedItem.closest("table").get(0);
                                e("<table id='" + l.id + "' style='border-width: 0px;' class='dragSortItem " + l.className + "'><tr></tr></table>").appendTo("body").children().append(i.draggedItem)
                            }
                            var c = i.draggedItem.attr("style");
                            i.draggedItem.attr("data-origstyle", c ? c : "");
                            i.draggedItem.css({position: "absolute", opacity: .8, "z-index": 999, height: a, width: f});
                            i.scroll = {
                                moveX: 0,
                                moveY: 0,
                                maxX: e(document).width() - e(window).width(),
                                maxY: e(document).height() - e(window).height()
                            };
                            i.scroll.scrollY = window.setInterval(function () {
                                if (n.scrollContainer !== window) {
                                    e(n.scrollContainer).scrollTop(e(n.scrollContainer).scrollTop() + i.scroll.moveY);
                                    return
                                }
                                var t = e(n.scrollContainer).scrollTop();
                                if (i.scroll.moveY > 0 && t < i.scroll.maxY || i.scroll.moveY < 0 && t > 0) {
                                    e(n.scrollContainer).scrollTop(t + i.scroll.moveY);
                                    i.draggedItem.css("top", i.draggedItem.offset().top + i.scroll.moveY + 1)
                                }
                            }, 10);
                            i.scroll.scrollX = window.setInterval(function () {
                                if (n.scrollContainer !== window) {
                                    e(n.scrollContainer).scrollLeft(e(n.scrollContainer).scrollLeft() + i.scroll.moveX);
                                    return
                                }
                                var t = e(n.scrollContainer).scrollLeft();
                                if (i.scroll.moveX > 0 && t < i.scroll.maxX || i.scroll.moveX < 0 && t > 0) {
                                    e(n.scrollContainer).scrollLeft(t + i.scroll.moveX);
                                    i.draggedItem.css("left", i.draggedItem.offset().left + i.scroll.moveX + 1)
                                }
                            }, 10);
                            e(r).each(function (e, t) {
                                t.createDropTargets();
                                t.buildPositionTable()
                            });
                            i.setPos(t.pageX, t.pageY);
                            e(document).bind("mousemove", i.swapItems);
                            e(document).bind("mouseup", i.dropItem);
                            if (n.scrollContainer !== window) e(window).bind("wheel", i.wheel)
                        },
                        setPos: function (t, r) {
                            var s = r - this.offset.top;
                            var o = t - this.offset.left;
                            if (!n.dragBetween) {
                                s = Math.min(this.offsetLimit.bottom, Math.max(s, this.offsetLimit.top));
                                o = Math.min(this.offsetLimit.right, Math.max(o, this.offsetLimit.left))
                            }
                            var u = this.draggedItem.offsetParent().not("body").offset();
                            if (u != null) {
                                s -= u.top;
                                o -= u.left
                            }
                            if (n.scrollContainer === window) {
                                r -= e(window).scrollTop();
                                t -= e(window).scrollLeft();
                                r = Math.max(0, r - e(window).height() + 5) + Math.min(0, r - 5);
                                t = Math.max(0, t - e(window).width() + 5) + Math.min(0, t - 5)
                            } else {
                                var a = e(n.scrollContainer);
                                var f = a.offset();
                                r = Math.max(0, r - a.height() - f.top) + Math.min(0, r - f.top);
                                t = Math.max(0, t - a.width() - f.left) + Math.min(0, t - f.left)
                            }
                            i.scroll.moveX = t === 0 ? 0 : t * n.scrollSpeed / Math.abs(t);
                            i.scroll.moveY = r === 0 ? 0 : r * n.scrollSpeed / Math.abs(r);
                            this.draggedItem.css({top: s, left: o})
                        },
                        wheel: function (t) {
                            if (i && n.scrollContainer !== window) {
                                var r = e(n.scrollContainer);
                                var s = r.offset();
                                t = t.originalEvent;
                                if (t.clientX > s.left && t.clientX < s.left + r.width() && t.clientY > s.top && t.clientY < s.top + r.height()) {
                                    var o = (t.deltaMode === 0 ? 1 : 10) * t.deltaY;
                                    r.scrollTop(r.scrollTop() + o);
                                    t.preventDefault()
                                }
                            }
                        },
                        buildPositionTable: function () {
                            var t = [];
                            this.getItems().not([i.draggedItem[0], i.placeHolderItem[0]]).each(function (n) {
                                var r = e(this).offset();
                                r.right = r.left + e(this).outerWidth();
                                r.bottom = r.top + e(this).outerHeight();
                                r.elm = this;
                                t[n] = r
                            });
                            this.pos = t
                        },
                        dropItem: function () {
                            if (i.draggedItem == null) return;
                            var t = i.draggedItem.attr("data-origstyle");
                            i.draggedItem.attr("style", t);
                            if (t === "") i.draggedItem.removeAttr("style");
                            i.draggedItem.removeAttr("data-origstyle");
                            i.styleDragHandlers(true);
                            i.placeHolderItem.before(i.draggedItem);
                            i.placeHolderItem.remove();
                            e("[data-droptarget], .dragSortItem").remove();
                            window.clearInterval(i.scroll.scrollY);
                            window.clearInterval(i.scroll.scrollX);
                            if (i.draggedItem.attr("data-origpos") !== e(r).index(i) + "-" + e(i.container).children().index(i.draggedItem)) if (n.dragEnd.apply(i.draggedItem) === false) {
                                var s = i.draggedItem.attr("data-origpos").split("-");
                                var o = e(r[s[0]].container).children().not(i.draggedItem).eq(s[1]);
                                if (o.size() > 0) o.before(i.draggedItem); else if (s[1] === 0) e(r[s[0]].container).prepend(i.draggedItem); else e(r[s[0]].container).append(i.draggedItem)
                            }
                            i.draggedItem.removeAttr("data-origpos");
                            i.draggedItem = null;
                            e(document).unbind("mousemove", i.swapItems);
                            e(document).unbind("mouseup", i.dropItem);
                            if (n.scrollContainer !== window) e(window).unbind("wheel", i.wheel);
                            return false
                        },
                        swapItems: function (t) {
                            if (i.draggedItem == null) return false;
                            i.setPos(t.pageX, t.pageY);
                            var o = i.findPos(t.pageX, t.pageY);
                            var u = i;
                            for (var a = 0; o === -1 && n.dragBetween && a < r.length; a++) {
                                o = r[a].findPos(t.pageX, t.pageY);
                                u = r[a]
                            }
                            if (o === -1) return false;
                            var f = function () {
                                return e(u.container).children().not(u.draggedItem)
                            };
                            var l = f().not(n.itemSelector).each(function (e) {
                                this.idx = f().index(this)
                            });
                            if (s == null || s.top > i.draggedItem.offset().top || s.left > i.draggedItem.offset().left) e(u.pos[o].elm).before(i.placeHolderItem); else e(u.pos[o].elm).after(i.placeHolderItem);
                            l.each(function () {
                                var t = f().eq(this.idx).get(0);
                                if (this !== t && f().index(this) < this.idx) e(this).insertAfter(t); else if (this !== t) e(this).insertBefore(t)
                            });
                            e(r).each(function (e, t) {
                                t.createDropTargets();
                                t.buildPositionTable()
                            });
                            s = i.draggedItem.offset();
                            return false
                        },
                        findPos: function (e, t) {
                            for (var n = 0; n < this.pos.length; n++) {
                                if (this.pos[n].left < e && this.pos[n].right > e && this.pos[n].top < t && this.pos[n].bottom > t) return n
                            }
                            return -1
                        },
                        createDropTargets: function () {
                            if (!n.dragBetween) return;
                            e(r).each(function () {
                                var t = e(this.container).find("[data-placeholder]");
                                var r = e(this.container).find("[data-droptarget]");
                                if (t.size() > 0 && r.size() > 0) r.remove(); else if (t.size() === 0 && r.size() === 0) {
                                    if (n.tagName === "td") e(n.placeHolderTemplate).attr("data-droptarget", true).appendTo(this.container); else e(this.container).append(i.placeHolderItem.removeAttr("data-placeholder").clone().attr("data-droptarget", true));
                                    i.placeHolderItem.attr("data-placeholder", true)
                                }
                            })
                        }
                    };
                    u.init();
                    r.push(u)
                });
                return this
            };
            e.fn.dragsort.defaults = {
                itemSelector: "",
                dragSelector: "",
                dragSelectorExclude: "input, textarea",
                dragEnd: function () {
                },
                dragBetween: false,
                placeHolderTemplate: "",
                scrollContainer: window,
                scrollSpeed: 5
            }
        }

        static #initXY(xy, root) {
            let panelWrapper =
                $(`
                    <div class="${xy === "y" ? "vertical" : "horizontal"}-panel-wrapper">
                     ${xy === "y" ? "<div class='toggle-panel'><div class='tc'></div></div>" : ""}
                         <i class="item-icon-add">
                            <svg t="1648779147774" class="icon" viewBox="0 0 1024 1024" version="1.1"
                            xmlns="http://www.w3.org/2000/svg" p-id="1633" width="20" height="20">
                            <path d="M512 1024C229.229714 1024 0 794.770286 0 512S229.229714 0 512 0s512
                            229.229714 512 512-229.229714 512-512 512z m0-928C282.258286 96 96 282.258286 96
                            512S282.258286 928 512 928 928 741.741714 928 512 741.741714 96 512 96z m208.018286
                            463.981714h-160v160.036572a48.018286 48.018286 0 0 1-96.036572 0v-160.036572H303.981714a47.981714
                            47.981714 0 0 1 0-95.963428h160V304.018286a48.018286 48.018286 0 0 1 96.036572 0v160h160a47.981714
                             47.981714 0 0 1 0 95.963428z" fill="" p-id="1634"></path>
                             </svg>
                         </i>
                     <div class="item-wrapper"></div>
                    </div>
                `)
            root.append(panelWrapper)
        }

        #handleCSS() {
            $(".vertical-panel-wrapper>.item-wrapper")
                .mouseenter(function () {
                    $(this).parent().children(".item-icon-add")
                        .css({display: "block"})
                }).mouseleave(function () {
                $(this).parent().children(".item-icon-add")
                    .css({display: "none"})
            }).children().length === 0 &&
            $(".vertical-panel-wrapper>.item-wrapper")
                .css({height: "100%"})
            $(".vertical-panel-wrapper>.item-icon-add")
                .mouseenter(function () {
                    $(this).css({display: "block"})
                })
                .mouseleave(function () {
                    $(this).css({display: "none"})
                })
        }

        static #handleData(data) {
            let xTitles, yTitles
            for (let key in data) {
                key === "vert" ? yTitles = data[key] : xTitles = data[key]
            }
            return {xTitles, yTitles}
        }

        static #itemContent(xy, ts) {
            return $(`<div id=${xy + "-" + Math.random().toString(36).slice(-4)}
                              draggable="true" class="item"
                              style="${xy === "y" ? "height" : "width"}:${ts.size || ''}px">
                            <span>${ts.title}</span>
                            <i class="item-icon-delete">
                                <svg t="1648779026180" class="icon" viewBox="0 0 1024 1024" version="1.1"
                                    xmlns="http://www.w3.org/2000/svg" p-id="1483" width="20" height="20">
                                    <path d="M512 1024C229.229714 1024 0 794.770286 0 512S229.229714 0 512 0s512
                                    229.229714 512 512-229.229714 512-512 512z m0-928C282.258286 96 96 282.258286
                                    96 512S282.258286 928 512 928 928 741.741714 928 512 741.741714 96 512 96z m207.981714
                                    463.981714H304.018286a47.981714 47.981714 0 1 1 0-95.963428h415.963428a47.981714 47.981714 0 1 1 0 95.963428z"
                                    fill="" p-id="1484"></path>
                                </svg>
                            </i>
                       </div>`)
        }

        getData(xy) {
            return xy ?
                xy === "x" ? Lane.#handleData(this.#data).xTitles : Lane.#handleData(this.#data).yTitles
                : this.#data
        }

        add(xy, data, able = true) {
            if (!xy || !data) throw new Error("需要传入xy和data")
            if (xy !== "x" && xy !== "y") throw new Error("参数只能是x或y")
            if (!data.title || data.title.match(/^[ ]*$/)) throw new Error("data需要title")
            able && xy === 'x'
                ? this.#data.horz.push(data?.title)
                : this.#data.vert.push(data?.title)
            $("." + `${xy === "x" ? "horizontal" : "vertical"}`
                + "-panel-wrapper>.item-wrapper")
                .append(Lane.#itemContent(xy, data))
            this.#removeField()
            // Lane.#dragItem()
        }

        #addDefaultField(xy, data) {
            let self = this
            $("." + `${xy === "y" ? "vertical" : "horizontal"}`
                + "-panel-wrapper>.item-icon-add")
                .on("click", function () {
                    self.add(xy, data)
                    self.#removeField()
                })
        }

        arrayIndex(array, value) {
            for (let i = 0; i < array.length; i++) {
                if (array[i] === value) return i
            }
            return -1
        }

        removeArray(arr, val) {
            this.arrayIndex(arr, val) > -1
            && arr.splice(this.arrayIndex(arr, val), 1)
        }

        #delete(el) {
            let {xTitles, yTitles} = Lane.#handleData(this.#data)
            el.parent().parent()[0].className.substr(0, 1) === "h" ?
                this.removeArray(xTitles, el[0].innerText) :
                this.removeArray(yTitles, el[0].innerText)
            el.remove()
        }

        #removeField() {
            let self = this
            $(".panel .item-icon-delete").off("click").on("click", function () {
                $(this).parents(".item-wrapper").children().length === 1 &&
                $(".vertical-panel-wrapper").children(".item-wrapper")
                    .css({height: "calc(100% - 40px)", width: "42px"})
                    .parent().children(".item-icon-add")
                    .css({display: "none"})
                self.#delete($(this).parent())
            })
        }

        #editable() {
            let that = this
            let {xTitles, yTitles} = Lane.#handleData(this.#data)
            this.root.on("dblclick", "span", function () {
                let self = $(this)
                let currentVal = self.text()
                let xy = self.parents(".item-wrapper").parent()[0].className.substr(0, 1)
                let currentIndex = that.arrayIndex(xy === "h" ? xTitles : yTitles, currentVal)
                $(this).attr("contenteditable", "true")
                self.css({background: "#f1eded", outline: "1px solid grey"})
                $(this).parents()[2].className.substr(0, 1) === "h" ?
                    self.css({padding: "0 12px"}) : self.css({padding: "12px 0", width: "100%"})
                $(this).focus()
                let sel = window.getSelection()
                sel.collapse(self[0], 1)
                $(this).on("blur", function () {
                    self.removeAttr("contenteditable")
                    self.css({background: "", outline: "", padding: "", width: ""})
                    self.text().trim() === '' && self.text(currentVal)
                    if (xy === "h") xTitles[currentIndex] = self.text()
                    else yTitles[currentIndex] = self.text()
                })
            })
        }

        #togglePanel() {
            let self = this
            $(".toggle-panel").on("dblclick", function () {
                let x = $(".horizontal-panel-wrapper>.item-wrapper").children(".item")
                let y = $(".vertical-panel-wrapper>.item-wrapper").children(".item")
                let xLength = x.length
                let yLength = y.length
                if (xLength === yLength) {
                    for (let i = 0; i < xLength; i++) {
                        let xSize = x[i].offsetWidth
                        let xTitle = x[i].innerText
                        self.#delete($(x[i]))
                        self.add("y", {title: xTitle, size: xSize})
                        let ySize = y[i].offsetHeight
                        let yTitle = y[i].innerText
                        self.#delete($(y[i]))
                        self.add("x", {title: yTitle, size: ySize})
                    }
                } else {
                    if (xLength > yLength) {
                        for (let i = 0; i < xLength; i++) {
                            let xSize = x[i].offsetWidth
                            let xTitle = x[i].innerText
                            self.#delete($(x[i]))
                            self.add("y", {title: xTitle, size: xSize})
                            try {
                                let ySize = y[i].offsetHeight
                                let yTitle = y[i].innerText
                                self.#delete($(y[i]))
                                self.add("x", {title: yTitle, size: ySize})
                            } catch (e) {
                            }
                        }
                    } else {
                        for (let i = 0; i < yLength; i++) {
                            let ySize = y[i].offsetHeight
                            let yTitle = y[i].innerText
                            self.#delete($(y[i]))
                            self.add("x", {title: yTitle, size: ySize})
                            try {
                                let xSize = x[i].offsetWidth
                                let xTitle = x[i].innerText
                                self.#delete($(x[i]))
                                self.add("y", {title: xTitle, size: xSize})
                            } catch (e) {
                            }
                        }
                    }
                }
                console.log("切换后：", self.getData())
            })
        }
    }

    let v = new Lane($(".panel"))
    v.add("x", {title: "业务部", size: 100})
    // v.add("x", {title: "xxx111"})
    v.add("y", {title: "起草", size: 300});
    // v.add("y", {title: "yyy"})
    // console.log(v.getData(""))
    // console.log(v.getData("x"))
    // console.log(v.getData("y"))

    /*
    (function (e) {
            e.fn.dragsort = function (t) {
                if (t === "destroy") {
                    e(this.selector).trigger("dragsort-uninit");
                    return
                }
                let n = e.extend({}, e.fn.dragsort.defaults, t);
                let r = [];
                let i = null, s = null;
                this.each(function (t, o) {
                    if (e(o).is("table")
                        && e(o).children().size() === 1
                        && e(o).children().is("tbody")) o = e(o).children().get(0);
                    let u = {
                        draggedItem: null,
                        placeHolderItem: null,
                        pos: null,
                        offset: null,
                        offsetLimit: null,
                        scroll: null,
                        container: o,
                        init: function () {
                            n.tagName = e(this.container).children().size() === 0 ? "li" : e(this.container).children().get(0).tagName.toLowerCase();
                            if (n.itemSelector === "") n.itemSelector = n.tagName;
                            if (n.dragSelector === "") n.dragSelector = n.tagName;
                            if (n.placeHolderTemplate === "") n.placeHolderTemplate = "<" + n.tagName + ">&nbsp;</" + n.tagName + ">";
                            e(this.container).attr("data-listidx", t).mousedown(this.grabItem).bind("dragsort-uninit", this.uninit);
                            this.styleDragHandlers(true)
                        },
                        uninit: function () {
                            var t = r[e(this).attr("data-listidx")];
                            e(t.container).unbind("mousedown", t.grabItem).unbind("dragsort-uninit");
                            t.styleDragHandlers(false)
                        },
                        getItems: function () {
                            return e(this.container).children(n.itemSelector)
                        },
                        styleDragHandlers: function (t) {
                            this.getItems().map(function () {
                                return e(this).is(n.dragSelector) ? this : e(this).find(n.dragSelector).get()
                            }).css("cursor", t ? "pointer" : "")
                        },
                        grabItem: function (t) {
                            var i = r[e(this).attr("data-listidx")];
                            var s = e(t.target).closest("[data-listidx] > " + n.tagName).get(0);
                            var o = i.getItems().filter(function () {
                                return this === s
                            }).size() > 0;
                            if (t.which !== 1 || e(t.target).is(n.dragSelectorExclude) || e(t.target).closest(n.dragSelectorExclude).size() > 0 || !o) return;
                            t.preventDefault();
                            var u = t.target;
                            while (!e(u).is(n.dragSelector)) {
                                if (u === this) return;
                                u = u.parentNode
                            }
                            e(u).attr("data-cursor", e(u).css("cursor"));
                            e(u).css("cursor", "move");
                            var a = this;
                            var f = function () {
                                i.dragStart.call(a, t);
                                e(i.container).unbind("mousemove", f)
                            };
                            e(i.container).mousemove(f).mouseup(function () {
                                e(i.container).unbind("mousemove", f);
                                e(u).css("cursor", e(u).attr("data-cursor"))
                            })
                        },
                        dragStart: function (t) {
                            if (i != null && i.draggedItem != null) i.dropItem();
                            i = r[e(this).attr("data-listidx")];
                            i.draggedItem = e(t.target).closest("[data-listidx] > " + n.tagName);
                            i.draggedItem.attr("data-origpos", e(this).attr("data-listidx") + "-" + e(i.container).children().index(i.draggedItem));
                            var s = parseInt(i.draggedItem.css("marginTop"));
                            var o = parseInt(i.draggedItem.css("marginLeft"));
                            i.offset = i.draggedItem.offset();
                            i.offset.top = t.pageY - i.offset.top + (isNaN(s) ? 0 : s) - 1;
                            i.offset.left = t.pageX - i.offset.left + (isNaN(o) ? 0 : o) - 1;
                            if (!n.dragBetween) {
                                var u = e(i.container).outerHeight() === 0 ? Math.max(1, Math.round(.5 + i.getItems().size() * i.draggedItem.outerWidth() / e(i.container).outerWidth())) * i.draggedItem.outerHeight() : e(i.container).outerHeight();
                                i.offsetLimit = e(i.container).offset();
                                i.offsetLimit.right = i.offsetLimit.left + e(i.container).outerWidth() - i.draggedItem.outerWidth();
                                i.offsetLimit.bottom = i.offsetLimit.top + u - i.draggedItem.outerHeight()
                            }
                            var a = i.draggedItem.height();
                            var f = i.draggedItem.width();
                            if (n.tagName === "tr") {
                                i.draggedItem.children().each(function () {
                                    e(this).width(e(this).width())
                                });
                                i.placeHolderItem = i.draggedItem.clone().attr("data-placeholder", true);
                                i.draggedItem.after(i.placeHolderItem);
                                i.placeHolderItem.children().each(function () {
                                    e(this).css({
                                        borderWidth: 0,
                                        width: e(this).width() + 1,
                                        height: e(this).height() + 1
                                    }).html("&nbsp;")
                                })
                            } else {
                                i.draggedItem.after(n.placeHolderTemplate);
                                i.placeHolderItem = i.draggedItem.next().css({
                                    height: a,
                                    width: f
                                }).attr("data-placeholder", true)
                            }
                            if (n.tagName === "td") {
                                var l = i.draggedItem.closest("table").get(0);
                                e("<table id='" + l.id + "' style='border-width: 0px;' class='dragSortItem " + l.className + "'><tr></tr></table>").appendTo("body").children().append(i.draggedItem)
                            }
                            var c = i.draggedItem.attr("style");
                            i.draggedItem.attr("data-origstyle", c ? c : "");
                            i.draggedItem.css({position: "absolute", opacity: .8, "z-index": 999, height: a, width: f});
                            i.scroll = {
                                moveX: 0,
                                moveY: 0,
                                maxX: e(document).width() - e(window).width(),
                                maxY: e(document).height() - e(window).height()
                            };
                            i.scroll.scrollY = window.setInterval(function () {
                                if (n.scrollContainer !== window) {
                                    e(n.scrollContainer).scrollTop(e(n.scrollContainer).scrollTop() + i.scroll.moveY);
                                    return
                                }
                                var t = e(n.scrollContainer).scrollTop();
                                if (i.scroll.moveY > 0 && t < i.scroll.maxY || i.scroll.moveY < 0 && t > 0) {
                                    e(n.scrollContainer).scrollTop(t + i.scroll.moveY);
                                    i.draggedItem.css("top", i.draggedItem.offset().top + i.scroll.moveY + 1)
                                }
                            }, 10);
                            i.scroll.scrollX = window.setInterval(function () {
                                if (n.scrollContainer !== window) {
                                    e(n.scrollContainer).scrollLeft(e(n.scrollContainer).scrollLeft() + i.scroll.moveX);
                                    return
                                }
                                var t = e(n.scrollContainer).scrollLeft();
                                if (i.scroll.moveX > 0 && t < i.scroll.maxX || i.scroll.moveX < 0 && t > 0) {
                                    e(n.scrollContainer).scrollLeft(t + i.scroll.moveX);
                                    i.draggedItem.css("left", i.draggedItem.offset().left + i.scroll.moveX + 1)
                                }
                            }, 10);
                            e(r).each(function (e, t) {
                                t.createDropTargets();
                                t.buildPositionTable()
                            });
                            i.setPos(t.pageX, t.pageY);
                            e(document).bind("mousemove", i.swapItems);
                            e(document).bind("mouseup", i.dropItem);
                            if (n.scrollContainer !== window) e(window).bind("wheel", i.wheel)
                        },
                        setPos: function (t, r) {
                            var s = r - this.offset.top;
                            var o = t - this.offset.left;
                            if (!n.dragBetween) {
                                s = Math.min(this.offsetLimit.bottom, Math.max(s, this.offsetLimit.top));
                                o = Math.min(this.offsetLimit.right, Math.max(o, this.offsetLimit.left))
                            }
                            var u = this.draggedItem.offsetParent().not("body").offset();
                            if (u != null) {
                                s -= u.top;
                                o -= u.left
                            }
                            if (n.scrollContainer === window) {
                                r -= e(window).scrollTop();
                                t -= e(window).scrollLeft();
                                r = Math.max(0, r - e(window).height() + 5) + Math.min(0, r - 5);
                                t = Math.max(0, t - e(window).width() + 5) + Math.min(0, t - 5)
                            } else {
                                var a = e(n.scrollContainer);
                                var f = a.offset();
                                r = Math.max(0, r - a.height() - f.top) + Math.min(0, r - f.top);
                                t = Math.max(0, t - a.width() - f.left) + Math.min(0, t - f.left)
                            }
                            i.scroll.moveX = t === 0 ? 0 : t * n.scrollSpeed / Math.abs(t);
                            i.scroll.moveY = r === 0 ? 0 : r * n.scrollSpeed / Math.abs(r);
                            this.draggedItem.css({top: s, left: o})
                        },
                        wheel: function (t) {
                            if (i && n.scrollContainer !== window) {
                                var r = e(n.scrollContainer);
                                var s = r.offset();
                                t = t.originalEvent;
                                if (t.clientX > s.left && t.clientX < s.left + r.width() && t.clientY > s.top && t.clientY < s.top + r.height()) {
                                    var o = (t.deltaMode === 0 ? 1 : 10) * t.deltaY;
                                    r.scrollTop(r.scrollTop() + o);
                                    t.preventDefault()
                                }
                            }
                        },
                        buildPositionTable: function () {
                            var t = [];
                            this.getItems().not([i.draggedItem[0], i.placeHolderItem[0]]).each(function (n) {
                                var r = e(this).offset();
                                r.right = r.left + e(this).outerWidth();
                                r.bottom = r.top + e(this).outerHeight();
                                r.elm = this;
                                t[n] = r
                            });
                            this.pos = t
                        },
                        dropItem: function () {
                            if (i.draggedItem == null) return;
                            var t = i.draggedItem.attr("data-origstyle");
                            i.draggedItem.attr("style", t);
                            if (t === "") i.draggedItem.removeAttr("style");
                            i.draggedItem.removeAttr("data-origstyle");
                            i.styleDragHandlers(true);
                            i.placeHolderItem.before(i.draggedItem);
                            i.placeHolderItem.remove();
                            e("[data-droptarget], .dragSortItem").remove();
                            window.clearInterval(i.scroll.scrollY);
                            window.clearInterval(i.scroll.scrollX);
                            if (i.draggedItem.attr("data-origpos") !== e(r).index(i) + "-" + e(i.container).children().index(i.draggedItem)) if (n.dragEnd.apply(i.draggedItem) === false) {
                                var s = i.draggedItem.attr("data-origpos").split("-");
                                var o = e(r[s[0]].container).children().not(i.draggedItem).eq(s[1]);
                                if (o.size() > 0) o.before(i.draggedItem); else if (s[1] === 0) e(r[s[0]].container).prepend(i.draggedItem); else e(r[s[0]].container).append(i.draggedItem)
                            }
                            i.draggedItem.removeAttr("data-origpos");
                            i.draggedItem = null;
                            e(document).unbind("mousemove", i.swapItems);
                            e(document).unbind("mouseup", i.dropItem);
                            if (n.scrollContainer !== window) e(window).unbind("wheel", i.wheel);
                            return false
                        },
                        swapItems: function (t) {
                            if (i.draggedItem == null) return false;
                            i.setPos(t.pageX, t.pageY);
                            var o = i.findPos(t.pageX, t.pageY);
                            var u = i;
                            for (var a = 0; o === -1 && n.dragBetween && a < r.length; a++) {
                                o = r[a].findPos(t.pageX, t.pageY);
                                u = r[a]
                            }
                            if (o === -1) return false;
                            var f = function () {
                                return e(u.container).children().not(u.draggedItem)
                            };
                            var l = f().not(n.itemSelector).each(function (e) {
                                this.idx = f().index(this)
                            });
                            if (s == null || s.top > i.draggedItem.offset().top || s.left > i.draggedItem.offset().left) e(u.pos[o].elm).before(i.placeHolderItem); else e(u.pos[o].elm).after(i.placeHolderItem);
                            l.each(function () {
                                var t = f().eq(this.idx).get(0);
                                if (this !== t && f().index(this) < this.idx) e(this).insertAfter(t); else if (this !== t) e(this).insertBefore(t)
                            });
                            e(r).each(function (e, t) {
                                t.createDropTargets();
                                t.buildPositionTable()
                            });
                            s = i.draggedItem.offset();
                            return false
                        },
                        findPos: function (e, t) {
                            for (var n = 0; n < this.pos.length; n++) {
                                if (this.pos[n].left < e && this.pos[n].right > e && this.pos[n].top < t && this.pos[n].bottom > t) return n
                            }
                            return -1
                        },
                        createDropTargets: function () {
                            if (!n.dragBetween) return;
                            e(r).each(function () {
                                var t = e(this.container).find("[data-placeholder]");
                                var r = e(this.container).find("[data-droptarget]");
                                if (t.size() > 0 && r.size() > 0) r.remove(); else if (t.size() === 0 && r.size() === 0) {
                                    if (n.tagName === "td") e(n.placeHolderTemplate).attr("data-droptarget", true).appendTo(this.container); else e(this.container).append(i.placeHolderItem.removeAttr("data-placeholder").clone().attr("data-droptarget", true));
                                    i.placeHolderItem.attr("data-placeholder", true)
                                }
                            })
                        }
                    };
                    u.init();
                    r.push(u)
                });
                return this
            };
            e.fn.dragsort.defaults = {
                itemSelector: "",
                dragSelector: "",
                dragSelectorExclude: "input, textarea",
                dragEnd: function () {
                },
                dragBetween: false,
                placeHolderTemplate: "",
                scrollContainer: window,
                scrollSpeed: 5
            }
        }
    )(jQuery)
     */

    $(function () {
        // $(".horizontal-panel-wrapper .item-wrapper").dragsort({
        //     dragSelector: ".item",
        // })
    })
</script>
</body>
</html>
